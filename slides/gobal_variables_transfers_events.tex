% Choose one to switch between slides and handout
\documentclass[]{beamer}
%\documentclass[handout]{beamer}

% Video Meta Data
\title{Smart Contracts and Decentralized Finance}
\subtitle{Solidity Basics: Global Variables, Transfers, and Events}
\author{Prof. Dr. Fabian Schär}
\institute{University of Basel}

% Config File
\input{../config/config.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\thispagestyle{empty}
\begin{frame}[noframenumbering]
	\titlepage
\end{frame}

%%%
\begin{frame}{Time on the Blockchain}

\begin{minipage}{0.3\textwidth}
	\begin{figure}
		\center
		\includegraphics[width= 2.2cm]{../assets/images/time.png}	
	\end{figure}
\end{minipage}
\begin{minipage}{0.65\textwidth}
	\textbf{Goal:} Contract users must be able to set an end time for their auction.\\
	
	\color{highlight}\textbf{How does a contract keep track of time?}
\end{minipage}

\vspace{2em}

\uncover<2->{

Solidity offers \globvar{global variables.}

\vspace{1em}

\textbf{Example:} \globvar{block.timestamp} gives us the time that the miner sets in the block where our transaction is included.\\

\vspace{1em}

\textbf{Security consideration:} This information can be influenced by the miner.
}
	
\end{frame}
%%%


%%%
\begin{frame}{Other Block Variables }

\begin{itemize}
	\item \globvar{block.basefee} returns current block’s base fee.
	\item \globvar{block.chainid} returns current chain id.
	\item \globvar{block.coinbase} returns the miner address of the current block.
	\item \globvar{block.difficulty} returns current block difficulty.
	\item \globvar{block.gaslimit} returns current block gaslimit.
	\item \globvar{block.number} returns the current block number.
\end{itemize}

\vspace{1.5em}

\link \href{https://docs.soliditylang.org/en/v0.8.9/units-and-global-variables.html}{Solidity Documentation: Block and Transaction Properties}.

	
\end{frame}
%%%


%%%
\begin{frame}{Other Global Variables}

\textbf{Frequently used}
\begin{itemize}
	\item \globvar{msg.sender} sender address of the message (current call).\\
		\textit{This is not necessarily the origin of the transaction, it can be the address of another contract that made an internal call.}
	\item \globvar{msg.value} ether amount in wei sent with the message.
\end{itemize}

\vspace{0.5em}

\uncover<2->{

\textbf{Others}
\begin{itemize}
	\item \globvar{msg.data} complete calldata.
	\item \globvar{msg.sig} first four bytes of the calldata indicating the function that is called.
	\item \globvar{tx.origin} address of the \textbf{original} sender of the transaction.
	\item \globvar{tx.gasprice} gas price of the transaction.
	\item \globvar{blockhash(blockNumber)} hash of the indicated block.
\end{itemize}

\vspace{0.5em}

\link \href{https://docs.soliditylang.org/en/v0.8.9/cheatsheet.html}{Solidity Documentation: Cheatsheet | Global Variables}.

}
	
\end{frame}
%%%


%%%
\begin{frame}{Units}

Solidity supports time and monetary units natively.

\uncover<2->{

\begin{samplecode}{Ether Units}
	\input{../assets/solidity_code/ether_units.tex}
\end{samplecode}

The most common are \typesunits{wei} $(1)$,  \typesunits{gwei} $(10^9)$, and  \typesunits{ether} $(10^{18})$.
}

\vspace{1.5em}

\uncover<3->{

Time suffixes can be used to convert to seconds. Supported are \typesunits{seconds}, \typesunits{minutes}, \typesunits{hours}, \typesunits{days}, \typesunits{weeks}.
\begin{samplecode}{Time Units}
	\input{../assets/solidity_code/time_units.tex}
\end{samplecode} 
%
%$\Rightarrow$ months or years are \textbf{not} supported.
}

\end{frame}
%%%

%%%
\begin{frame}{Suffixes and Variables}

\textbf{Keep in mind:} Usage of variables with suffixes is disallowed.

\vspace{1.5em}
\begin{samplecode}{Hours to Seconds}
	\input{../assets/solidity_code/suffix_wrong.tex}
\end{samplecode}

\end{frame}
%%%


%%%
\begin{frame}{Add Duration to the Auction}

\begin{samplecode}{Auction Parameters}
	\input{../assets/solidity_code/auction_duration.tex}
\end{samplecode} 
	
\end{frame}
%%%


%%%
\begin{frame}{Function Restrictions and Requirements}

Often, functions in a contract need to be restricted in some way.

\vspace{0.5em}

\textbf{Example:} We need a \texttt{bid()} function in our auction contract, but it should only be callable before the auction ended.

\uncover<2->{
\vspace{1.5em}

In Solidity we use \genkey{require}\texttt{(<condition>, <error message>);} to implement a restriction.

\begin{samplecode}{Restricted bid() Function}
	\input{../assets/solidity_code/bid_restriction.tex}
\end{samplecode}

$\Rightarrow$ A \genkey{require} statement evaluating to \texttt{false}), \textbf{reverts the whole transaction.}
}
	
\end{frame}
%%

%
%%%
\begin{frame}{Building the bid() function}

\textbf{Accept and store valid bids:}
\begin{itemize}
	\item Add \genkey{payable} modifier to be able to receive ether.\\
	\textit{All ether received is in full control of the contract.}
	\item Check if bid (\globvar{msg.value}) is higher than previous valid bid.
	\item Store the new highest bid and bidder (\globvar{msg.sender}).
\end{itemize}

\begin{samplecode}{bid() Function}
	\input{../assets/solidity_code/bid_function.tex}
\end{samplecode}


\end{frame}
%%%


%%%
\begin{frame}{Refunding the Outbidden}

If a new bid is accepted, we need to refund the previous bidders.

\vspace{1em}

\textbf{Remember:} A smart contract can't initiate transactions by itself

\vspace{1.5em}
\uncover<2->{
\textbf{Options:}
\begin{itemize}
	\item Refund as part of the new bid transaction.\\
	\uncover<3->{\textit{Passing execution to another address introduces significant security risk.}}
	\item Allow the user to withdraw his invalidated bids.\\
	\uncover<3->{\textbf{Preferred option}}
\end{itemize}
}

\end{frame}
%%%


%%%
\begin{frame}{Title}

\end{frame}
%%%


%%%
\begin{frame}{Title}

\end{frame}
%%%


%%%
\begin{frame}{Title}

\end{frame}
%%%


%%%
\begin{frame}{Title}

\end{frame}
%%%


%%%
\begin{frame}{Bullets and Uncover Animations}

This is how lists can be used in the template. \\ \vspace{1em}

Some of the main features of this template:
	
	\begin{itemize}
		\item<1-> stay focused
		\item<2-> save ink
		\item<3-> do not get distracted
	\end{itemize}

	\vspace{1em}	
	\uncover<4->{The same works for Enumerate environments:}

	\begin{enumerate}
		\item<5-> This is the first point
		\item<6-> and the second one
		\item<7-> Last but not least, the third one
	\end{enumerate}
	
\end{frame}
%%%	

%%%
\begin{frame}{Tables}
	\begin{table}
		\begin{tabular}{ll}
			A & B\\
			C & D
		\end{tabular}
		\caption{This is a table}
		\label{tbl:simpletable}
	\end{table}
\end{frame}

%%%


%%%
\begin{frame}{Box Conventions}
	
	\begin{columns}[T]
		\begin{column}{0.45\textwidth}
			\vspace{-1em}
			\begin{samplecode}{Basic Contract Structure (Solidity)}
				Pragma solidity  \textasciicircum 0.4.19; \
				contract HelloWorld \{ \\
				\color{softanthracite} /* This is where you write your code */
			\end{samplecode}			
		\end{column} %\hfill

		\begin{column}{0.5\textwidth}
			\textbf{Sample Code Box}\\
			Contains code snippets in Solidity or pseudo code.
		\end{column}
	\end{columns}

\vspace{2.5em}

	\begin{columns}[T]
		\begin{column}{0.45\textwidth}
			\vspace{-0.8em}
			\begin{keytakeaway}{Transaction Definitions}
				A transaction is a message send by an externally owned account.
			\end{keytakeaway}			
		\end{column}
		
		\begin{column}{0.5\textwidth}
			\textbf{Key Take-Away}\\
			Highlights important concepts and definitions.
		\end{column}
	\end{columns}

\vspace{2.5em}

	\begin{columns}[T]
		\begin{column}{0.45\textwidth}
			\vspace{-0.9em}
			\begin{exercise}{Exercise 1}
				Get Ropsten Ether from the faucet and deploy your first smart contract on Ropsten Testnet.
			\end{exercise}					
		\end{column}
		\begin{column}{0.5\textwidth}
		\textbf{Exercises}\\
			Things for you to try out.
		\end{column}
	\end{columns}

\end{frame}

%%%


%%%
\begin{frame}{Code Sample}
	\begin{samplecode}{Minimum viable token}
		\input{../assets/solidity_code/minimum-viable-token.tex}
	\end{samplecode}
\end{frame}
%%%


%%%
\begin{frame}{Equations}

Some in-line math can be used like this $y=x^2+2x-5$. \\ \vspace{1em}

However, in many cases it makes sense to use numbered equations. The $\&$-sign can be used to set anchor points, e.g. around the ``$=$'' for multiple equations. This is shown below in Equation \eqref{eq:firststep} and Equation \eqref{eq:secondstep}.
	\begin{align}
		y + 2x &= x^2+2x-5 \label{eq:firststep}\\
		y &= x^2-5 \label{eq:secondstep}
	\end{align}
\end{frame}
%%%

%%%
\begin{frame}{Figures}
	\begin{figure}
		\center
		\includegraphics[width=0.8\textwidth]{../config/logo_cif}	
		\caption{Center for Innovative Finance Logo}
		\label{fig:logo}
	\end{figure}
\end{frame}
%%%

%%%
\begin{frame}{Links}
		Links are signaled with the respective icon, which is set up in the config file and can be called with the respective command.\\
		
		\link \href{https://github.com/cifunibas}{Repository: CIF on GitHub}.
		
\end{frame}
%%%


%%%
\begin{frame}{Labels and (Non-Bib) References}
	In some cases in can make sense to reference to a figure, table or equation on a different slide. Use \texttt{$\backslash$pageref\{$<$label$>$\}} if you want to highlight, that there is a related resource on slide \pageref{fig:logo}.\\ \vspace{1em}
	
	Do - under no circumstances - hardcode references.	
\end{frame}
%%%

%%%
\begin{frame}{Bib-References}
		Read the Bitcoin Whitepaper, \cite{nakamotoBitcoin2008}.
\end{frame}
%%%

%%%
\begin{frame}%[allowframebreaks]
\frametitle{References and Recommended Reading}
	\bibliographystyle{amsplain}
	\bibliography{../assets/bib/refs}
\end{frame}
%%%



\end{document}